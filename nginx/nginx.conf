# nginx/nginx.conf - CORRECTED for N-Green Strategy

events { }

http {
  server {
    listen 80; # Nginx listens on port 80 INSIDE its Docker container

    # --- MAIN FRONTEND ROUTING ---
    # For the root path and all other non-/api paths, proxy to the 'frontend' service
    location / {
      proxy_pass http://frontend:3000; # <--- Proxy to the frontend service, running internally on port 3000
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      # Add other frontend specific headers if needed
    }

    # --- API BACKEND ROUTING ---
    # For API requests, proxy to the 'backend' service
    location /api/ { # <--- Good to keep trailing slash for consistency here
      proxy_pass http://backend:5000; # <--- Proxy to the backend service, running internally on port 5000
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      # Add other backend specific headers if needed
    }
  }
}
